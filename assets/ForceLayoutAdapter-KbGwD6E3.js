const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B4NOZCLv.js","assets/index-BzRJ2RaR.js"])))=>i.map(i=>d[i]);
var dt=Object.defineProperty;var ft=(a,t,e)=>t in a?dt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var j=(a,t,e)=>ft(a,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class _t{constructor(){this.viewBox={left:-100,top:-100,right:100,bottom:100},this.transform={scale:1,x:0,y:0},this.width=0,this.height=0,this.pixelRatio=typeof window<"u"?window.devicePixelRatio:1,this._visibleBounds={left:0,top:0,right:0,bottom:0},this._visibleBoundsDirty=!0,this._reusableScenePoint={x:0,y:0},this._reusableScreenPoint={x:0,y:0}}setSize(t,e){this.width=t,this.height=e,this._visibleBoundsDirty=!0}setViewBox(t,e,i,s){this.viewBox.left=t,this.viewBox.top=e,this.viewBox.right=i,this.viewBox.bottom=s}setTransform(t,e,i){this.transform.scale=t,this.transform.x=e,this.transform.y=i,this._visibleBoundsDirty=!0}getNodeScreenSize(t){return t*this.transform.scale}screenToScene(t,e){const i=this._reusableScenePoint;return i.x=(t-this.transform.x)/this.transform.scale,i.y=(e-this.transform.y)/this.transform.scale,i}sceneToScreen(t,e){const i=this._reusableScreenPoint;return i.x=t*this.transform.scale+this.transform.x,i.y=e*this.transform.scale+this.transform.y,i}getVisibleBounds(){return this._updateVisibleBounds(),this._visibleBounds}_updateVisibleBounds(){if(this._visibleBoundsDirty){this._visibleBoundsDirty=!1;const t=this.transform.scale,e=this.transform.x,i=this.transform.y;this._visibleBounds.left=(0-e)/t,this._visibleBounds.top=(0-i)/t,this._visibleBounds.right=(this.width-e)/t,this._visibleBounds.bottom=(this.height-i)/t}}isVisible(t,e,i=0){this._updateVisibleBounds();const s=this._visibleBounds;return t+i>=s.left&&t-i<=s.right&&e+i>=s.top&&e-i<=s.bottom}getTransformString(){return`translate(${this.transform.x}, ${this.transform.y}) scale(${this.transform.scale})`}}function ut(a,t){const{onPanStart:e,onPanMove:i,onPanEnd:s,onZoom:n}=t;let r=!1,o=0,h=0;const l=[];function d(f,g,u,v){f.addEventListener(g,u,v),l.push({target:f,event:g,handler:u,options:v})}function _(f){f.button===0&&(r=!0,o=f.clientX,h=f.clientY,e&&e({x:o,y:h,event:f}),f.preventDefault())}function m(f){if(!r)return;const g=f.clientX-o,u=f.clientY-h;o=f.clientX,h=f.clientY,i&&i({dx:g,dy:u,x:o,y:h,event:f})}function y(f){r&&(r=!1,s&&s({x:f.clientX,y:f.clientY,event:f}))}function p(f){f.preventDefault();let g=f.deltaY;f.deltaMode===1?g*=40:f.deltaMode===2&&(g*=800);const u=1-g*.003,v=a.getBoundingClientRect(),x=f.clientX-v.left,M=f.clientY-v.top;n&&n({factor:u,x,y:M,event:f})}function c(f){const g=a.getBoundingClientRect(),u=f.clientX-g.left,v=f.clientY-g.top;n&&n({factor:2,x:u,y:v,event:f})}return d(a,"mousedown",_),d(window,"mousemove",m),d(window,"mouseup",y),d(a,"wheel",p,{passive:!1}),d(a,"dblclick",c),{dispose(){for(const{target:f,event:g,handler:u,options:v}of l)f.removeEventListener(g,u,v);l.length=0}}}class mt{constructor(t){this.id=t.identifier,this.x=t.clientX,this.y=t.clientY,this.lastX=this.x,this.lastY=this.y}move(t){this.lastX=this.x,this.lastY=this.y,this.x=t.clientX,this.y=t.clientY}}function pt(a,t){const{onPanStart:e,onPanMove:i,onPanEnd:s,onZoom:n}=t;let r=new Map,o=!1,h=0,l=0,d=null;a.addEventListener("touchstart",_,{passive:!1});function _(f){o||(p(),o=!0);for(let g=0;g<f.touches.length;g++){const u=f.touches[g];r.has(u.identifier)||r.set(u.identifier,new mt(u))}if(f.touches.length===1){const g=f.touches[0];e&&e({x:g.clientX,y:g.clientY,event:f})}f.preventDefault(),f.stopPropagation()}function m(f){const g=Date.now();let u=0,v=0,x=0,M=0,S=null,w=null;for(let X=0;X<f.touches.length;X++){const P=f.touches[X],L=r.get(P.identifier);L&&(L.move(P),x+=L.x,M+=L.y,u+=L.x-L.lastX,v+=L.y-L.lastY,S?w||(w=L):S=L)}const Y=f.touches.length;if(Y===0)return;if(u/=Y,v/=Y,x/=Y,M/=Y,S&&w){l=g;const X=Math.hypot(w.x-S.x,w.y-S.y),P=Math.hypot(w.lastX-S.lastX,w.lastY-S.lastY);if(P>0){const L=X/P,O=a.getBoundingClientRect(),Z=x-O.left,A=M-O.top;n&&n({factor:L,x:Z,y:A,event:f})}f.preventDefault(),f.stopPropagation()}const C=g-l;f.touches.length===1&&C>100&&(u!==0||v!==0)&&i&&i({dx:u,dy:v,x,y:M,event:f})}function y(f){const g=Date.now(),u=g-h;h=g;for(let v=0;v<f.changedTouches.length;v++){const x=f.changedTouches[v];r.delete(x.identifier)}if(f.touches.length===0){if(r.clear(),o=!1,c(),f.changedTouches.length===1&&g-l>350){const v=f.changedTouches[0];if(u<350&&d&&Math.hypot(v.clientX-d.clientX,v.clientY-d.clientY)<30){const M=a.getBoundingClientRect(),S=v.clientX-M.left,w=v.clientY-M.top;n&&n({factor:2,x:S,y:w,event:f})}d={clientX:v.clientX,clientY:v.clientY}}s&&s({x:0,y:0,event:f})}}function p(){document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("touchend",y,{passive:!1}),document.addEventListener("touchcancel",y,{passive:!1})}function c(){document.removeEventListener("touchmove",m,{passive:!1}),document.removeEventListener("touchend",y,{passive:!1}),document.removeEventListener("touchcancel",y,{passive:!1})}return{dispose(){a.removeEventListener("touchstart",_,{passive:!1}),c(),r.clear()}}}function gt(a={}){const{friction:t=.92,minVelocity:e=.5,onUpdate:i=()=>{}}=a;let s=0,n=0,r=0,o=null,h=!1;const l=[],d=5;function _(p,c){const f=performance.now();for(l.push({dx:p,dy:c,time:f});l.length>d;)l.shift()}function m(){if(l.length<2)return{vx:0,vy:0};let p=0,c=0,f=0;for(let g=1;g<l.length;g++){const u=l[g].time-l[g-1].time;u>0&&(p+=l[g].dx,c+=l[g].dy,f+=u)}return f===0?{vx:0,vy:0}:{vx:p/f*16,vy:c/f*16}}function y(){o=null;const p=performance.now(),c=Math.min(p-r,32);r=p;const f=c/16,g=Math.pow(t,f);if(s*=g,n*=g,Math.sqrt(s*s+n*n)<e){s=0,n=0;return}i(s*f,n*f),o=requestAnimationFrame(y)}return{startTracking(){h=!0,l.length=0,this.stop()},track(p,c){h&&_(p,c)},release(){h=!1;const{vx:p,vy:c}=m();s=p,n=c,l.length=0,Math.sqrt(s*s+n*n)>=e&&(r=performance.now(),o=requestAnimationFrame(y))},stop(){o!==null&&(cancelAnimationFrame(o),o=null),s=0,n=0},isAnimating(){return o!==null},dispose(){this.stop(),l.length=0}}}function yt(a,t,e={}){const{onTransform:i=()=>{}}=e;let s=e.minZoom||.1,n=e.maxZoom||20,r=null,o=null,h=null,l=null,d=null;function _(c,f){const{x:g,y:u,scale:v}=t.transform;t.setTransform(v,g+c,u+f),i()}function m(c,f,g){const{x:u,y:v,scale:x}=t.transform;let M=x*c;if(M=Math.max(s,Math.min(n,M)),M===x)return;const S=M/x,w=f-(f-u)*S,Y=g-(g-v)*S;t.setTransform(M,w,Y),i()}h=gt({onUpdate(c,f){_(c,f)}});const y={onPanStart(){h.startTracking()},onPanMove({dx:c,dy:f}){_(c,f),h.track(c,f)},onPanEnd(){h.release()},onZoom({factor:c,x:f,y:g}){m(c,f,g)}};r=ut(a,y),o=pt(a,y);function p(){l!==null&&(cancelAnimationFrame(l),l=null),d&&(d(),d=null)}return{setZoomLimits(c,f){s=c,n=f},getZoom(){return t.transform.scale},setZoom(c,f=!1){if(f){const v=(t.width/2-t.transform.x)/t.transform.scale,x=(t.height/2-t.transform.y)/t.transform.scale;return this.flyTo(v,x,c)}const{width:g,height:u}=t;m(c/t.transform.scale,g/2,u/2)},pan(c,f){_(c,f)},flyTo(c,f,g,u=300){return new Promise(v=>{h.stop(),p(),d=v;const x=t.transform.x,M=t.transform.y,S=t.transform.scale,w=Math.max(s,Math.min(n,g)),{width:Y,height:C}=t,B=Y/2-c*w,X=C/2-f*w,P=performance.now();function L(){const Z=performance.now()-P,A=Math.min(Z/u,1),W=1-Math.pow(1-A,3),ht=x+(B-x)*W,lt=M+(X-M)*W,ct=S+(w-S)*W;t.setTransform(ct,ht,lt),i(),A<1?l=requestAnimationFrame(L):(l=null,d=null,v())}l=requestAnimationFrame(L)})},stop(){h.stop(),p()},dispose(){p(),r&&(r.dispose(),r=null),o&&(o.dispose(),o=null),h&&(h.dispose(),h=null)}}}const tt="http://www.w3.org/2000/svg";function At(a,t={}){const{viewBox:e={left:-100,top:-100,right:100,bottom:100},panZoom:i={}}=t,s=document.createElementNS(tt,"svg");s.style.position="relative",s.style.width="100%",s.style.height="100%",s.style.display="block",s.style.overflow="hidden",a.appendChild(s);const n=document.createElementNS(tt,"g");n.setAttribute("class","scene-transform"),s.appendChild(n);const r=new _t;r.setViewBox(e.left,e.top,e.right,e.bottom);const o=[],h={render:[],transform:[],resize:[]};let l=null,d=!0;function _(){const u=a.getBoundingClientRect();r.setSize(u.width,u.height);const v=e.right-e.left,x=e.bottom-e.top,M=u.width/v,S=u.height/x,w=Math.min(M,S),Y=u.width/2,C=u.height/2,B=(e.left+e.right)/2,X=(e.top+e.bottom)/2;r.setTransform(w,Y-B*w,C-X*w),m("resize",{width:u.width,height:u.height}),p()}function m(u,v){const x=h[u];if(x)for(let M=0;M<x.length;M++)x[M](v)}function y(){if(l=null,!!d){d=!1,n.setAttribute("transform",r.getTransformString());for(let u=0;u<o.length;u++)o[u].render(r);m("render",r)}}function p(){d=!0,l===null&&(l=requestAnimationFrame(y))}let c=null;i.enabled!==!1&&(c=yt(s,r,{minZoom:i.minZoom||.1,maxZoom:i.maxZoom||20,onTransform:()=>{m("transform",r.transform),p()}}));const f=new ResizeObserver(()=>{_()});f.observe(a),_();const g={svg:s,root:n,drawContext:r,addCollection(u){o.push(u);const v=u.getRoot();return v&&n.appendChild(v),p(),u},removeCollection(u){const v=o.indexOf(u);if(v!==-1){o.splice(v,1);const x=u.getRoot();x&&x.parentNode&&x.parentNode.removeChild(x),p()}},requestRender:p,on(u,v){return h[u]&&h[u].push(v),g},off(u,v){if(h[u]){const x=h[u].indexOf(v);x!==-1&&h[u].splice(x,1)}return g},getPanZoom(){return c},flyTo(u,v,x,M=300){return c?c.flyTo(u,v,x,M):Promise.resolve()},fitToView(u,v=20){const{width:x,height:M}=r,S=u.right-u.left,w=u.bottom-u.top,Y=(x-v*2)/S,C=(M-v*2)/w,B=Math.min(Y,C),X=(u.left+u.right)/2,P=(u.top+u.bottom)/2;return this.flyTo(X,P,B)},dispose(){l!==null&&(cancelAnimationFrame(l),l=null),f.disconnect(),c&&(c.dispose(),c=null);for(let u=0;u<o.length;u++)o[u].dispose&&o[u].dispose();o.length=0;for(const u in h)h[u].length=0;s.parentNode&&s.parentNode.removeChild(s)}};return g}function vt(a,t,e,i,s){rt(a,t,e||0,i||a.length-1,s||xt)}function rt(a,t,e,i,s){for(;i>e;){if(i-e>600){var n=i-e+1,r=t-e+1,o=Math.log(n),h=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*h*(n-h)/n)*(r-n/2<0?-1:1),d=Math.max(e,Math.floor(t-r*h/n+l)),_=Math.min(i,Math.floor(t+(n-r)*h/n+l));rt(a,t,d,_,s)}var m=a[t],y=e,p=i;for(D(a,e,t),s(a[i],m)>0&&D(a,e,i);y<p;){for(D(a,y,p),y++,p--;s(a[y],m)<0;)y++;for(;s(a[p],m)>0;)p--}s(a[e],m)===0?D(a,e,p):(p++,D(a,p,i)),p<=t&&(e=p+1),t<=p&&(i=p-1)}}function D(a,t,e){var i=a[t];a[t]=a[e],a[e]=i}function xt(a,t){return a<t?-1:a>t?1:0}class J{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!F(t,e))return i;const s=this.toBBox,n=[];for(;e;){for(let r=0;r<e.children.length;r++){const o=e.children[r],h=e.leaf?s(o):o;F(t,h)&&(e.leaf?i.push(o):U(t,h)?this._all(o,i):n.push(o))}e=n.pop()}return i}collides(t){let e=this.data;if(!F(t,e))return!1;const i=[];for(;e;){for(let s=0;s<e.children.length;s++){const n=e.children[s],r=e.leaf?this.toBBox(n):n;if(F(t,r)){if(e.leaf||U(t,r))return!0;i.push(n)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=N([]),this}remove(t,e){if(!t)return this;let i=this.data;const s=this.toBBox(t),n=[],r=[];let o,h,l;for(;i||n.length;){if(i||(i=n.pop(),h=n[n.length-1],o=r.pop(),l=!0),i.leaf){const d=bt(t,i.children,e);if(d!==-1)return i.children.splice(d,1),n.push(i),this._condense(n),this}!l&&!i.leaf&&U(i,s)?(n.push(i),r.push(o),o=0,h=i,i=i.children[0]):h?(o++,i=h.children[o],l=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,s){const n=i-e+1;let r=this._maxEntries,o;if(n<=r)return o=N(t.slice(e,i+1)),T(o,this.toBBox),o;s||(s=Math.ceil(Math.log(n)/Math.log(r)),r=Math.ceil(n/Math.pow(r,s-1))),o=N([]),o.leaf=!1,o.height=s;const h=Math.ceil(n/r),l=h*Math.ceil(Math.sqrt(r));et(t,e,i,l,this.compareMinX);for(let d=e;d<=i;d+=l){const _=Math.min(d+l-1,i);et(t,d,_,h,this.compareMinY);for(let m=d;m<=_;m+=h){const y=Math.min(m+h-1,_);o.children.push(this._build(t,m,y,s-1))}}return T(o,this.toBBox),o}_chooseSubtree(t,e,i,s){for(;s.push(e),!(e.leaf||s.length-1===i);){let n=1/0,r=1/0,o;for(let h=0;h<e.children.length;h++){const l=e.children[h],d=q(l),_=wt(t,l)-d;_<r?(r=_,n=d<n?d:n,o=l):_===r&&d<n&&(n=d,o=l)}e=o||e.children[0]}return e}_insert(t,e,i){const s=i?t:this.toBBox(t),n=[],r=this._chooseSubtree(s,this.data,e,n);for(r.children.push(t),z(r,s);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(s,n,e)}_split(t,e){const i=t[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);const r=this._chooseSplitIndex(i,n,s),o=N(i.children.splice(r,i.children.length-r));o.height=i.height,o.leaf=i.leaf,T(i,this.toBBox),T(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)}_splitRoot(t,e){this.data=N([t,e]),this.data.height=t.height+1,this.data.leaf=!1,T(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,n=1/0,r=1/0;for(let o=e;o<=i-e;o++){const h=E(t,0,o,this.toBBox),l=E(t,o,i,this.toBBox),d=Lt(h,l),_=q(h)+q(l);d<n?(n=d,s=o,r=_<r?_:r):d===n&&_<r&&(r=_,s=o)}return s||i-e}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:Mt,n=t.leaf?this.compareMinY:St,r=this._allDistMargin(t,e,i,s),o=this._allDistMargin(t,e,i,n);r<o&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const n=this.toBBox,r=E(t,0,e,n),o=E(t,i-e,i,n);let h=R(r)+R(o);for(let l=e;l<i-e;l++){const d=t.children[l];z(r,t.leaf?n(d):d),h+=R(r)}for(let l=i-e-1;l>=e;l--){const d=t.children[l];z(o,t.leaf?n(d):d),h+=R(o)}return h}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)z(e[s],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():T(t[e],this.toBBox)}}function bt(a,t,e){if(!e)return t.indexOf(a);for(let i=0;i<t.length;i++)if(e(a,t[i]))return i;return-1}function T(a,t){E(a,0,a.children.length,t,a)}function E(a,t,e,i,s){s||(s=N(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let n=t;n<e;n++){const r=a.children[n];z(s,a.leaf?i(r):r)}return s}function z(a,t){return a.minX=Math.min(a.minX,t.minX),a.minY=Math.min(a.minY,t.minY),a.maxX=Math.max(a.maxX,t.maxX),a.maxY=Math.max(a.maxY,t.maxY),a}function Mt(a,t){return a.minX-t.minX}function St(a,t){return a.minY-t.minY}function q(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function R(a){return a.maxX-a.minX+(a.maxY-a.minY)}function wt(a,t){return(Math.max(t.maxX,a.maxX)-Math.min(t.minX,a.minX))*(Math.max(t.maxY,a.maxY)-Math.min(t.minY,a.minY))}function Lt(a,t){const e=Math.max(a.minX,t.minX),i=Math.max(a.minY,t.minY),s=Math.min(a.maxX,t.maxX),n=Math.min(a.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,n-i)}function U(a,t){return a.minX<=t.minX&&a.minY<=t.minY&&t.maxX<=a.maxX&&t.maxY<=a.maxY}function F(a,t){return t.minX<=a.maxX&&t.minY<=a.maxY&&t.maxX>=a.minX&&t.maxY>=a.minY}function N(a){return{children:a,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function et(a,t,e,i,s){const n=[t,e];for(;n.length;){if(e=n.pop(),t=n.pop(),e-t<=i)continue;const r=t+Math.ceil((e-t)/i/2)*i;vt(a,r,t,e,s),n.push(t,r,r,e)}}const it="http://www.w3.org/2000/svg";function b(a,t,e){return typeof a=="function"?a(t,e):a}function H(a){return a?String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""}function Yt(a){if(a.type&&!a.layers){const{minZoom:t,maxZoom:e,importance:i,hitArea:s,...n}=a;return{minZoom:t||0,maxZoom:e,importance:i,hitArea:s,layers:[n]}}return{minZoom:a.minZoom||0,maxZoom:a.maxZoom,importance:a.importance,hitArea:a.hitArea,layers:a.layers||[]}}function Xt(a,t,e){if(a.visible!==void 0&&!b(a.visible,t,e))return"";const i=a.type;if(i==="circle"){const s=b(a.radius,t,e)||4,n=b(a.fill,t,e)||"none",r=b(a.stroke,t,e)||"none",o=b(a.strokeWidth,t,e)||0,h=b(a.opacity,t,e),l=b(a.filter,t,e);let d=`r="${s}" fill="${n}"`;return r!=="none"&&(d+=` stroke="${r}"`),o&&(d+=` stroke-width="${o}"`),h!=null&&(d+=` opacity="${h}"`),l&&(d+=` filter="${l}"`),`<circle ${d}/>`}if(i==="rect"){const s=b(a.width,t,e)||10,n=b(a.height,t,e)||10,r=b(a.rx,t,e),o=b(a.ry,t,e),h=b(a.fill,t,e)||"none",l=b(a.stroke,t,e)||"none",d=b(a.strokeWidth,t,e)||0,_=b(a.opacity,t,e),m=b(a.filter,t,e);let y=`x="${-s/2}" y="${-n/2}" width="${s}" height="${n}" fill="${h}"`;return r!=null&&(y+=` rx="${r}"`),o!=null&&(y+=` ry="${o}"`),l!=="none"&&(y+=` stroke="${l}"`),d&&(y+=` stroke-width="${d}"`),_!=null&&(y+=` opacity="${_}"`),m&&(y+=` filter="${m}"`),`<rect ${y}/>`}if(i==="text"){const s=b(a.text,t,e);if(s==null||s==="")return"";const n=b(a.fontSize,t,e)||10,r=b(a.fill,t,e)||"#000",o=b(a.fontFamily,t,e),h=b(a.fontWeight,t,e),l=b(a.anchor,t,e)||"center",d=b(a.offset,t,e)||[0,0],_=b(a.opacity,t,e),m=b(a.maxWidth,t,e);let y="middle",p=d[0],c=d[1];l==="center"&&(c+=n*.35);let f=`x="${p}" y="${c}" text-anchor="${y}" font-size="${n}" fill="${r}"`;o&&(f+=` font-family="${o}"`),h&&(f+=` font-weight="${h}"`),_!=null&&(f+=` opacity="${_}"`);const g=String(s);if(m&&g.length*n*.6>m){const u=at(g,n,m),v=n*1.3;let x="";for(let M=0;M<u.length;M++)M===0?x+=`<tspan x="${p}">${H(u[M])}</tspan>`:x+=`<tspan x="${p}" dy="${v}">${H(u[M])}</tspan>`;return`<text ${f}>${x}</text>`}return`<text ${f}>${H(g)}</text>`}return i==="render"&&typeof a.render=="function"&&a.render(t,e)||""}function at(a,t,e){const i=t*.6,s=Math.max(1,Math.floor(e/i)),n=a.split(/\s+/),r=[];let o="";for(let h=0;h<n.length;h++){const l=n[h],d=o?o+" "+l:l;d.length>s&&o?(r.push(o),o=l):o=d}return o&&r.push(o),r}function $(a,t,e){const i=a.layers;if(!i||i.length===0)return"";let s="";for(let n=0;n<i.length;n++)s+=Xt(i[n],t,e);return s}function G(a,t,e){const i=a.layers;let s=0,n=0;for(let r=0;r<i.length;r++){const o=i[r];if(o.visible!==void 0&&!b(o.visible,t,e))continue;const h=o.type;if(h==="circle"){const d=(b(o.radius,t,e)||4)*2;d>s&&(s=d),d>n&&(n=d)}else if(h==="rect"){const l=b(o.width,t,e)||10,d=b(o.height,t,e)||10;l>s&&(s=l),d>n&&(n=d)}else if(h==="text"){const l=b(o.text,t,e);if(!l)continue;const d=b(o.fontSize,t,e)||10,_=b(o.offset,t,e)||[0,0],m=b(o.maxWidth,t,e),y=String(l);let p,c;if(m&&y.length*d*.6>m){const f=at(y,d,m);p=m+Math.abs(_[0])*2,c=f.length*d*1.3+Math.abs(_[1])}else p=y.length*d*.6+Math.abs(_[0])*2,c=d+Math.abs(_[1]);p>s&&(s=p),n+=c}}if(a.hitArea){const r=a.hitArea;r.type==="rect"&&(s=b(r.width,t,e)||s,n=b(r.height,t,e)||n)}return{width:s,height:n}}function Pt(a,t,e){const i=a.layers;for(let s=0;s<i.length;s++){const n=i[s];if(n.type==="circle")return{type:"circle",radius:b(n.radius,t,e)||4};if(n.type==="rect")return{type:"rect",width:b(n.width,t,e)||10,height:b(n.height,t,e)||10}}return null}class Rt{constructor(t={}){j(this,"_transitionRafId",null);this._dataFn=t.data||null,this._maxScale=t.maxScale??1,this._levels=(t.levels||[]).map(Yt),this._collisionTrees=new Map,this._spatialIndex=new J,this._spatialValid=!1,this._positionsDirty=!0,this._attachedNodes=new Set,this._swapAttachedSet=new Set,this._maxNodeSize=0,this._root=document.createElementNS(it,"g"),this._root.setAttribute("class","node-collection"),this._nodes=[],this._nodeMap=new Map,this._freeIndices=[],this._batchDepth=0,this._batchDirty=!1,this._elementPool=[],this._lastDrawContext=null,this._lastScale=1,this._lastCollisionZoom=0,this._lastCandidateLevel=void 0,this._state=new Map,this._resolvedLevels=new Map,this._prevResolvedLevels=new Map,this._transitions=new Map,this._transitionDuration=150,this._reusableCtx={zoom:1},this._reusableCtxKeys=[],this._collisionInterval=t.collisionInterval??200,this._lastCollisionTime=0,this._collisionNodes=[],this._collisionCandidates=[],this._collisionStable=[],this._graph=t.graph||null,this._graphChangeListener=null,this._graph&&this._dataFn&&this._bindGraph()}getRoot(){return this._root}add(t){const{id:e=this._generateId(),x:i=0,y:s=0,data:n={}}=t,r=this._computeNodeSize(n);let o;this._freeIndices.length>0?o=this._freeIndices.pop():o=this._nodes.length;const h={id:e,index:o,x:i,y:s,size:r,data:n,visible:!0,_element:null,_currentLevel:-1,_inDOM:!1,_collection:this,_stateVersion:0,_renderedLevel:-1,_renderedStateVersion:-1};return this._nodes[o]=h,this._nodeMap.set(e,h),r>this._maxNodeSize&&(this._maxNodeSize=r),this._createNodeElement(h),this._spatialValid=!1,this._batchDepth===0?this._addNodeToScene(h,this._lastDrawContext):this._batchDirty=!0,h}remove(t){const e=typeof t=="object"?t:this._nodeMap.get(t);e&&(e._element&&(e._inDOM&&(this._root.removeChild(e._element),e._inDOM=!1),this._elementPool.push(e._element),e._element=null),this._freeIndices.push(e.index),this._nodes[e.index]=null,this._nodeMap.delete(e.id),this._attachedNodes.delete(e),this._state.delete(e.id),this._resolvedLevels.delete(e.id),this._prevResolvedLevels.delete(e.id),this._transitions.delete(e.id),this._spatialValid=!1,this._batchDepth>0&&(this._batchDirty=!0))}get(t){return this._nodeMap.get(t)}setPosition(t,e,i){t.x=e,t.y=i,this._positionsDirty=!0,this._batchDepth===0&&t._element&&t._inDOM&&this._applyTransform(t)}_applyTransform(t){if(!t._element)return;const e=Math.min(1,this._maxScale/this._lastScale);e!==1?t._element.setAttribute("transform",`translate(${t.x}, ${t.y}) scale(${e})`):t._element.setAttribute("transform",`translate(${t.x}, ${t.y})`)}setState(t,e,i){const s=typeof t=="object"?t.id:t;let n=this._state.get(s);i?(n||(n=new Map,this._state.set(s,n)),n.set(e,!0)):n&&(n.delete(e),n.size===0&&this._state.delete(s));const r=this._nodeMap.get(s);r&&(r._stateVersion++,r._element&&(i?r._element.classList.add(e):r._element.classList.remove(e)))}getState(t,e){const i=typeof t=="object"?t.id:t,s=this._state.get(i);return s&&s.get(e)||!1}invalidateContent(){for(const t of this._nodeMap.values())t._stateVersion++}clearState(t){for(const[e,i]of this._state)if(i.has(t)){i.delete(t),i.size===0&&this._state.delete(e);const s=this._nodeMap.get(e);s&&(s._stateVersion++,s._element&&s._element.classList.remove(t))}}_reapplyState(t){if(!t._element)return;t._element.setAttribute("class","node");const e=this._state.get(t.id);if(e)for(const i of e.keys())t._element.classList.add(i)}_buildCtx(t){const e=this._reusableCtx,i=this._reusableCtxKeys;for(let n=0;n<i.length;n++)e[i[n]]=void 0;i.length=0,e.zoom=this._lastScale;const s=this._state.get(t);if(s)for(const[n,r]of s)e[n]=r,i.push(n);return e}getNodeShape(t){const e=this._nodeMap.get(t);if(!e)return null;const i=this._resolvedLevels.get(t)??0;if(i<0||i>=this._levels.length)return null;const s=this._levels[i],n=this._buildCtx(t),r=Pt(s,e.data,n);if(!r)return null;const o=Math.min(1,this._maxScale/this._lastScale);return r.type==="circle"?{type:"circle",radius:r.radius*o,x:e.x,y:e.y}:r.type==="rect"?{type:"rect",width:r.width*o,height:r.height*o,x:e.x,y:e.y}:null}getContentScale(){return Math.min(1,this._maxScale/this._lastScale)}syncPositions(t){this.beginBatch();for(const[e,i]of t){const s=this._nodeMap.get(e);s&&(s.x=i.x,s.y=i.y)}this._positionsDirty=!0,this.endBatch()}getNodeAt(t,e,i){if(i||(i=this._lastDrawContext),!i)return null;const s=i.screenToScene(t,e),n=Math.max(this._maxNodeSize,80/this._lastScale);this._spatialValid||(this._rebuildSpatialIndex(),this._spatialValid=!0);const r=this._spatialIndex.search({minX:s.x-n,minY:s.y-n,maxX:s.x+n,maxY:s.y+n});let o=null,h=1/0;const l=Math.min(1,this._maxScale/this._lastScale),d=10/this._lastScale;for(let _=0;_<r.length;_++){const m=r[_].node,y=s.x-m.x,p=s.y-m.y,c=y*y+p*p;let f=!1;if(this._levels.length>0){const g=this._resolvedLevels.get(m.id)??0;if(g>=0&&g<this._levels.length){const u=this._levels[g],v=this._buildCtx(m.id),x=G(u,m.data,v),M=Math.max(x.width*l/2,d),S=Math.max(x.height*l/2,d);f=Math.abs(y)<=M&&Math.abs(p)<=S}}if(!f){const g=this.getNodeShape(m.id);if(g&&g.type==="circle"){const u=Math.max(g.radius,d);f=c<=u*u}else if(g&&g.type==="rect"){const u=Math.max(g.width/2,d),v=Math.max(g.height/2,d);f=Math.abs(y)<=u&&Math.abs(p)<=v}else{const u=Math.max(d,m.size*.5);f=c<=u*u}}f&&c<h&&(h=c,o=m)}return o?o.id:null}beginBatch(){this._batchDepth++}endBatch(){this._batchDepth>0&&this._batchDepth--,this._batchDepth===0&&this._batchDirty&&(this._batchDirty=!1,this.render(this._lastDrawContext))}forEach(t){for(let e=0;e<this._nodes.length;e++){const i=this._nodes[e];i&&t(i,i.id)}}get count(){return this._nodeMap.size}render(t){if(this._lastDrawContext=t,!t)return;const e=t.transform.scale,i=e!==this._lastScale;this._lastScale=e;const s=performance.now(),n=this._getCandidateLevelIndex(e),r=this._lastCandidateLevel!==void 0&&n!==this._lastCandidateLevel;this._lastCandidateLevel=n;const o=this._lastCollisionZoom>0?e/this._lastCollisionZoom:1/0,h=o>1.2,l=o<.83;r||l||this._positionsDirty&&s-this._lastCollisionTime>=this._collisionInterval?(this._computeResolvedLevels(t,!1),this._lastCollisionTime=s,this._lastCollisionZoom=e):h&&(this._computeResolvedLevels(t,!0),this._lastCollisionTime=s,this._lastCollisionZoom=e),this._positionsDirty?(this._positionsDirty=!1,this._spatialValid=!1,this._renderAllNodes(t,i)):(this._spatialValid||(this._rebuildSpatialIndex(),this._spatialValid=!0),this._renderWithSpatialQuery(t,i))}_computeResolvedLevels(t,e=!1){const i=this._lastScale,s=this._levels;if(s.length===0)return;const n=this._prevResolvedLevels;this._prevResolvedLevels=this._resolvedLevels,this._resolvedLevels=n,this._resolvedLevels.clear();const r=this._getCandidateLevelIndex(i),o=this._collisionNodes;o.length=0;for(let m=0;m<this._nodes.length;m++){const y=this._nodes[m];if(!y||!y.visible)continue;const p=Math.max(y.size,50/i);t.isVisible(y.x,y.y,p)&&o.push(y)}const h=Math.min(1,this._maxScale/i),l=this._collisionCandidates,d=this._collisionStable,_={minX:0,minY:0,maxX:0,maxY:0};for(let m=r;m>=0;m--){const y=s[m];if(i<y.minZoom||y.maxZoom!==void 0&&i>=y.maxZoom)continue;if(!y.importance){for(let c=0;c<o.length;c++){const f=o[c];this._resolvedLevels.has(f.id)||this._resolvedLevels.set(f.id,m)}break}let p=this._collisionTrees.get(m);if(p?p.clear():(p=new J,this._collisionTrees.set(m,p)),e){d.length=0;for(let c=0;c<o.length;c++){const f=o[c];if(this._resolvedLevels.has(f.id)||this._prevResolvedLevels.get(f.id)!==m)continue;const g=b(y.importance,f.data,this._buildCtx(f.id));d.push(f,g||0)}this._sortPairs(d);for(let c=0;c<d.length;c+=2){const f=d[c];this._fillBbox(_,f,y,h,i,t),p.collides(_)||(p.insert({minX:_.minX,minY:_.minY,maxX:_.maxX,maxY:_.maxY}),this._resolvedLevels.set(f.id,m))}}l.length=0;for(let c=0;c<o.length;c++){const f=o[c];if(this._resolvedLevels.has(f.id))continue;const g=b(y.importance,f.data,this._buildCtx(f.id));l.push(f,g||0)}this._sortPairs(l);for(let c=0;c<l.length;c+=2){const f=l[c];this._fillBbox(_,f,y,h,i,t),p.collides(_)||(p.insert({minX:_.minX,minY:_.minY,maxX:_.maxX,maxY:_.maxY}),this._resolvedLevels.set(f.id,m))}}for(let m=0;m<o.length;m++){const y=o[m];this._resolvedLevels.has(y.id)||this._resolvedLevels.set(y.id,0)}}_getCandidateLevelIndex(t){const e=this._levels;let i=0;for(let s=0;s<e.length;s++)t>=e[s].minZoom&&(e[s].maxZoom===void 0||t<e[s].maxZoom)&&(i=s);return i}_renderAllNodes(t,e){this._attachedNodes.clear();for(let i=0;i<this._nodes.length;i++){const s=this._nodes[i];if(!s||!s._element)continue;const n=Math.max(s.size,50/this._lastScale);t.isVisible(s.x,s.y,n)?(s._inDOM||(this._root.appendChild(s._element),s._inDOM=!0,this._reapplyState(s)),this._applyTransform(s),this._updateNodeContent(s,t,e),this._attachedNodes.add(s)):s._inDOM&&(this._root.removeChild(s._element),s._inDOM=!1)}}_renderWithSpatialQuery(t,e){const i=t.getVisibleBounds(),s=Math.max(this._maxNodeSize,100/this._lastScale),n=this._spatialIndex.search({minX:i.left-s,minY:i.top-s,maxX:i.right+s,maxY:i.bottom+s}),r=this._swapAttachedSet;r.clear();for(let o=0;o<n.length;o++){const h=n[o].node;if(!h._element)continue;const l=Math.max(h.size,50/this._lastScale);t.isVisible(h.x,h.y,l)&&(h._inDOM||(this._root.appendChild(h._element),h._inDOM=!0,this._reapplyState(h),this._applyTransform(h)),this._updateNodeContent(h,t,e),r.add(h))}for(const o of this._attachedNodes)!r.has(o)&&o._inDOM&&(this._root.removeChild(o._element),o._inDOM=!1);this._swapAttachedSet=this._attachedNodes,this._attachedNodes=r}_rebuildSpatialIndex(){const t=[];for(const e of this._nodes)e&&t.push({minX:e.x,minY:e.y,maxX:e.x,maxY:e.y,node:e});this._spatialIndex.clear(),t.length>0&&this._spatialIndex.load(t)}_addNodeToScene(t,e){if(!t._element||!e)return;const i=Math.max(t.size,50/this._lastScale);e.isVisible(t.x,t.y,i)&&(t._inDOM||(this._root.appendChild(t._element),t._inDOM=!0,this._reapplyState(t),this._attachedNodes.add(t)),this._updateNodeContent(t,e))}_updateNodeContent(t,e,i=!1){if(!t._element||!e||(i&&this._applyTransform(t),this._levels.length===0))return;const s=this._resolvedLevels.get(t.id)??0;t._currentLevel!==s&&(t._currentLevel>=0&&this._transitions.set(t.id,{fromLevel:t._currentLevel,toLevel:s,startTime:performance.now()}),t._currentLevel=s),!(!this._transitions.has(t.id)&&t._currentLevel===t._renderedLevel&&t._stateVersion===t._renderedStateVersion)&&(this._renderNode(t),t._renderedLevel=t._currentLevel,t._renderedStateVersion=t._stateVersion)}_renderNode(t){const e=this._levels,i=t._currentLevel;if(i<0||i>=e.length)return;const s=e[i],n=this._buildCtx(t.id),r=this._transitions.get(t.id);if(r){const o=performance.now()-r.startTime,h=Math.min(1,o/this._transitionDuration);if(h>=1){this._transitions.delete(t.id);const l=$(s,t.data,n);t._element.innerHTML=`<g>${l}</g>`}else{const l=e[r.fromLevel],d=e[r.toLevel],_=l?$(l,t.data,n):"",m=d?$(d,t.data,n):"";t._element.innerHTML=`<g opacity="${1-h}">${_}</g><g opacity="${h}">${m}</g>`,this._lastDrawContext&&this._scheduleTransitionFrame();return}}else{const o=$(s,t.data,n);t._element.innerHTML=`<g>${o}</g>`}}_scheduleTransitionFrame(){this._transitionRafId||(this._transitionRafId=requestAnimationFrame(()=>{if(this._transitionRafId=null,this._transitions.size>0)for(const[t]of this._transitions){const e=this._nodeMap.get(t);e&&e._inDOM&&this._renderNode(e)}}))}_fillBbox(t,e,i,s,n,r){const o=this._buildCtx(e.id),h=G(i,e.data,o),l=r.sceneToScreen(e.x,e.y),d=h.width*s*n/2,_=h.height*s*n/2;t.minX=l.x-d,t.minY=l.y-_,t.maxX=l.x+d,t.maxY=l.y+_}_sortPairs(t){const e=t.length>>1;if(!(e<=1))for(let i=1;i<e;i++){const s=t[i*2],n=t[i*2+1];let r=i-1;for(;r>=0&&t[r*2+1]<n;)t[(r+1)*2]=t[r*2],t[(r+1)*2+1]=t[r*2+1],r--;t[(r+1)*2]=s,t[(r+1)*2+1]=n}}clear(){for(let t=0;t<this._nodes.length;t++){const e=this._nodes[t];e&&this.remove(e)}this._nodes.length=0,this._freeIndices.length=0,this._nodeMap.clear(),this._attachedNodes.clear(),this._swapAttachedSet.clear(),this._spatialIndex.clear(),this._spatialValid=!1,this._maxNodeSize=0,this._state.clear(),this._resolvedLevels.clear(),this._prevResolvedLevels.clear(),this._transitions.clear(),this._collisionTrees.clear(),this._lastCollisionZoom=0,this._lastCandidateLevel=void 0}dispose(){this._graph&&this._graphChangeListener&&(this._graph.off("changed",this._graphChangeListener),this._graphChangeListener=null),this._transitionRafId&&(cancelAnimationFrame(this._transitionRafId),this._transitionRafId=null),this.clear(),this._elementPool.length=0,this._root.parentNode&&this._root.parentNode.removeChild(this._root)}_generateId(){return`node_${Date.now()}_${Math.random().toString(36).slice(2,9)}`}_computeNodeSize(t){const e=this._levels;if(e.length===0)return 10;let i=0;const s={zoom:1};for(let n=0;n<e.length;n++){const r=G(e[n],t,s),o=Math.max(r.width,r.height);o>i&&(i=o)}return i||10}_createNodeElement(t){let e=this._elementPool.pop();e||(e=document.createElementNS(it,"g")),e.setAttribute("class","node"),e.innerHTML="",t._element=e}_bindGraph(){const t=this._graph;this.beginBatch(),t.forEachNode(e=>{const i=this._dataFn(e);this.add({id:e.id,data:i})}),this.endBatch(),this._graphChangeListener=e=>{this.beginBatch();for(let i=0;i<e.length;i++){const s=e[i];if(s.node)if(s.changeType==="add"){if(!this._nodeMap.has(s.node.id)){const n=this._dataFn(s.node);this.add({id:s.node.id,data:n})}}else s.changeType==="remove"&&this.remove(s.node.id)}this.endBatch()},t.on("changed",this._graphChangeListener)}}function Ct(a,t,e){return{x:a*e,y:t*e}}function Bt(a,t,e,i){const s=Math.abs(a)||1e-10,n=Math.abs(t)||1e-10,r=e/s,o=i/n,h=Math.min(r,o);return{x:a*h,y:t*h}}function V(a,t,e){return e.type==="circle"?Ct(a,t,e.radius):e.type==="rect"?Bt(a,t,e.width/2,e.height/2):{x:0,y:0}}function K(a,t,e){return typeof a=="function"?a(t,e):a}class Ft{constructor(t={}){this._colorProp=t.color||"#999",this._widthProp=t.width||1,this._opacityProp=t.opacity||.6,this._allLiteralStyles=typeof this._colorProp!="function"&&typeof this._widthProp!="function"&&typeof this._opacityProp!="function",this._directed=t.directed||!1,this._dataFn=t.data||null,this._spatialIndex=new J,this._spatialValid=!1,this._positionsDirty=!0,this._edges=[],this._edgeMap=new Map,this._freeIndices=[],this._batchDepth=0,this._batchDirty=!1,this._lastDrawContext=null,this._lastScale=-1,this._state=new Map,this._stateVersion=0,this._arrowLength=t.arrowLength||10,this._arrowWidth=t.arrowWidth||5,this._graph=t.graph||null,this._nodeCollection=t.nodeCollection||null,this._graphChangeListener=null,this._cachedDirections=new Map,this._reusableCtx={zoom:1},this._reusableCtxKeys=[],this._batches=new Map,this._batchPool=[],this._container=t.container||null,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._canvas.style.pointerEvents="none",this._ctx2d=this._canvas.getContext("2d"),this._container&&(getComputedStyle(this._container).position==="static"&&(this._container.style.position="relative"),this._container.insertBefore(this._canvas,this._container.firstChild)),this._root=null,this._canvasWidth=0,this._canvasHeight=0,this._resizeObserver=null,this._container&&typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(()=>{this._resizeCanvas(),this._lastDrawContext&&this.render(this._lastDrawContext)}),this._resizeObserver.observe(this._container)),this._graph&&this._bindGraph()}getRoot(){return this._root}add(t){const{id:e=this._generateId(),fromX:i=0,fromY:s=0,toX:n=0,toY:r=0,data:o={}}=t;let h;this._freeIndices.length>0?h=this._freeIndices.pop():h=this._edges.length;const l={id:e,index:h,fromX:i,fromY:s,toX:n,toY:r,data:o,_collection:this};return this._edges[h]=l,this._edgeMap.set(e,l),this._spatialValid=!1,this._batchDepth>0&&(this._batchDirty=!0),l}remove(t){const e=typeof t=="object"?t:this._edgeMap.get(t);e&&(this._freeIndices.push(e.index),this._edges[e.index]=null,this._edgeMap.delete(e.id),this._state.delete(e.id),this._cachedDirections.delete(e.id),this._spatialValid=!1,this._batchDepth>0&&(this._batchDirty=!0))}get(t){return this._edgeMap.get(t)}setEndpoints(t,e,i,s,n){t.fromX=e,t.fromY=i,t.toX=s,t.toY=n,this._positionsDirty=!0}setState(t,e,i){const s=typeof t=="object"?t.id:t;let n=this._state.get(s);i?(n||(n=new Map,this._state.set(s,n)),n.set(e,!0)):n&&(n.delete(e),n.size===0&&this._state.delete(s)),this._stateVersion++}getState(t,e){const i=typeof t=="object"?t.id:t,s=this._state.get(i);return s&&s.get(e)||!1}clearState(t){let e=!1;for(const[i,s]of this._state)s.has(t)&&(s.delete(t),s.size===0&&this._state.delete(i),e=!0);e&&this._stateVersion++}_buildCtx(t){const e=this._reusableCtx,i=this._reusableCtxKeys;for(let n=0;n<i.length;n++)e[i[n]]=void 0;i.length=0,e.zoom=this._lastScale;const s=this._state.get(t);if(s)for(const[n,r]of s)e[n]=r,i.push(n);return e}syncPositions(t){if(!this._graph)return;const e=this._nodeCollection,i=this._directed&&e;this.beginBatch();for(const s of this._edges){if(!s)continue;const n=s.data.fromId,r=s.data.toId;if(!n||!r)continue;const o=t.get(n),h=t.get(r);if(!(!o||!h))if(i){const l=o.x-h.x,d=o.y-h.y,_=Math.sqrt(l*l+d*d);if(_>.001){const m=l/_,y=d/_;let p=this._cachedDirections.get(s.id);p?(p.dirX=m,p.dirY=y):(p={dirX:m,dirY:y},this._cachedDirections.set(s.id,p));const c=e.getNodeShape(r),f=e.getNodeShape(n);if(c){const g=V(m,y,c);s.toX=c.x+g.x,s.toY=c.y+g.y}else s.toX=h.x,s.toY=h.y;if(f){const g=V(-m,-y,f);s.fromX=f.x+g.x,s.fromY=f.y+g.y}else s.fromX=o.x,s.fromY=o.y}else s.fromX=o.x,s.fromY=o.y,s.toX=h.x,s.toY=h.y}else s.fromX=o.x,s.fromY=o.y,s.toX=h.x,s.toY=h.y}this._positionsDirty=!0,this.endBatch()}beginBatch(){this._batchDepth++}endBatch(){this._batchDepth>0&&this._batchDepth--,this._batchDepth===0&&this._batchDirty&&(this._batchDirty=!1,this.render(this._lastDrawContext))}forEach(t){for(let e=0;e<this._edges.length;e++){const i=this._edges[e];i&&t(i,i.id)}}get count(){return this._edgeMap.size}render(t){if(this._lastDrawContext=t,!t)return;const e=t.transform.scale,i=this._directed&&e!==this._lastScale;this._lastScale=e,(t.width!==this._canvasWidth||t.height!==this._canvasHeight)&&this._resizeCanvas(),i&&this._nodeCollection&&this._recomputeArrowOffsets(),this._positionsDirty?(this._positionsDirty=!1,this._spatialValid=!1,this._drawAllEdges(t)):(this._spatialValid||(this._rebuildSpatialIndex(),this._spatialValid=!0),this._drawWithSpatialQuery(t))}_resizeCanvas(){const t=this._lastDrawContext;let e,i;if(t)e=t.width,i=t.height;else if(this._container){const n=this._container.getBoundingClientRect();e=n.width,i=n.height}else return;const s=window.devicePixelRatio||1;this._canvas.width=e*s,this._canvas.height=i*s,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px",this._canvasWidth=e,this._canvasHeight=i}_drawAllEdges(t){const e=this._ctx2d,i=window.devicePixelRatio||1;if(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._canvas.width,this._canvas.height),e.setTransform(i,0,0,i,0,0),this._edgeMap.size===0)return;const s=t.transform.scale,n=t.transform.x,r=t.transform.y,o=t.getVisibleBounds(),h=o.left,l=o.right,d=o.top,_=o.bottom,m=this._directed,y=this._edges;if(this._allLiteralStyles&&this._state.size===0){e.strokeStyle=this._colorProp,e.lineWidth=this._widthProp,e.globalAlpha=this._opacityProp,e.beginPath();for(let p=0;p<y.length;p++){const c=y[p];if(!c)continue;const f=c.fromX<c.toX?c.fromX:c.toX,g=c.fromX>c.toX?c.fromX:c.toX,u=c.fromY<c.toY?c.fromY:c.toY,v=c.fromY>c.toY?c.fromY:c.toY;g<h||f>l||v<d||u>_||(e.moveTo(c.fromX*s+n,c.fromY*s+r),e.lineTo(c.toX*s+n,c.toY*s+r))}if(e.stroke(),m){e.fillStyle=this._colorProp;for(let p=0;p<y.length;p++){const c=y[p];if(!c)continue;const f=c.fromX<c.toX?c.fromX:c.toX,g=c.fromX>c.toX?c.fromX:c.toX,u=c.fromY<c.toY?c.fromY:c.toY,v=c.fromY>c.toY?c.fromY:c.toY;g<h||f>l||v<d||u>_||this._drawArrow(e,c.fromX*s+n,c.fromY*s+r,c.toX*s+n,c.toY*s+r,s)}}e.globalAlpha=1;return}for(let p=0;p<y.length;p++){const c=y[p];if(!c)continue;const f=c.fromX<c.toX?c.fromX:c.toX,g=c.fromX>c.toX?c.fromX:c.toX,u=c.fromY<c.toY?c.fromY:c.toY,v=c.fromY>c.toY?c.fromY:c.toY;g<h||f>l||v<d||u>_||this._addToBatch(c)}this._drawBatches(e,s,n,r,m)}_drawWithSpatialQuery(t){const e=this._ctx2d,i=window.devicePixelRatio||1;if(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this._canvas.width,this._canvas.height),e.setTransform(i,0,0,i,0,0),this._edgeMap.size===0)return;const s=t.transform.scale,n=t.transform.x,r=t.transform.y,o=t.getVisibleBounds(),h=this._directed,l=this._spatialIndex.search({minX:o.left,minY:o.top,maxX:o.right,maxY:o.bottom});if(l.length!==0){if(this._allLiteralStyles&&this._state.size===0){e.strokeStyle=this._colorProp,e.lineWidth=this._widthProp,e.globalAlpha=this._opacityProp,e.beginPath();for(let d=0;d<l.length;d++){const _=l[d].edge;e.moveTo(_.fromX*s+n,_.fromY*s+r),e.lineTo(_.toX*s+n,_.toY*s+r)}if(e.stroke(),h){e.fillStyle=this._colorProp;for(let d=0;d<l.length;d++){const _=l[d].edge;this._drawArrow(e,_.fromX*s+n,_.fromY*s+r,_.toX*s+n,_.toY*s+r,s)}}e.globalAlpha=1;return}for(let d=0;d<l.length;d++)this._addToBatch(l[d].edge);this._drawBatches(e,s,n,r,h)}}_addToBatch(t){const e=this._buildCtx(t.id),i=K(this._colorProp,t.data,e),s=K(this._widthProp,t.data,e),n=K(this._opacityProp,t.data,e),r=i+"|"+s+"|"+n;let o=this._batches.get(r);o||(o=this._batchPool.pop(),o?(o.color=i,o.width=s,o.opacity=n,o.count=0):o={color:i,width:s,opacity:n,edges:[],count:0},this._batches.set(r,o)),o.count<o.edges.length?o.edges[o.count]=t:o.edges.push(t),o.count++}_drawBatches(t,e,i,s,n){for(const r of this._batches.values()){t.strokeStyle=r.color,t.lineWidth=r.width,t.globalAlpha=r.opacity,t.beginPath();const o=r.edges,h=r.count;for(let l=0;l<h;l++){const d=o[l];t.moveTo(d.fromX*e+i,d.fromY*e+s),t.lineTo(d.toX*e+i,d.toY*e+s)}if(t.stroke(),n){t.fillStyle=r.color;for(let l=0;l<h;l++){const d=o[l];this._drawArrow(t,d.fromX*e+i,d.fromY*e+s,d.toX*e+i,d.toY*e+s,e)}}}t.globalAlpha=1;for(const r of this._batches.values())r.count=0,this._batchPool.push(r);this._batches.clear()}_drawArrow(t,e,i,s,n,r){const o=s-e,h=n-i,l=Math.sqrt(o*o+h*h);if(l<1)return;const d=o/l,_=h/l,m=-_,y=d,p=Math.min(1,r),c=this._arrowLength*p,f=this._arrowWidth/2*p,g=s-d*c,u=n-_*c;t.beginPath(),t.moveTo(s,n),t.lineTo(g+m*f,u+y*f),t.lineTo(g-m*f,u-y*f),t.closePath(),t.fill()}_rebuildSpatialIndex(){const t=[];for(const e of this._edges)e&&t.push({minX:Math.min(e.fromX,e.toX),minY:Math.min(e.fromY,e.toY),maxX:Math.max(e.fromX,e.toX),maxY:Math.max(e.fromY,e.toY),edge:e});this._spatialIndex.clear(),t.length>0&&this._spatialIndex.load(t)}_recomputeArrowOffsets(){const t=this._nodeCollection;if(t){for(const e of this._edges){if(!e)continue;const i=this._cachedDirections.get(e.id);if(!i)continue;const s=e.data.toId,n=e.data.fromId;if(s){const r=t.getNodeShape(s);if(r){const o=V(i.dirX,i.dirY,r);e.toX=r.x+o.x,e.toY=r.y+o.y}}if(n){const r=t.getNodeShape(n);if(r){const o=V(-i.dirX,-i.dirY,r);e.fromX=r.x+o.x,e.fromY=r.y+o.y}}}this._positionsDirty=!0,this._spatialValid=!1}}clear(){this._edges.length=0,this._freeIndices.length=0,this._edgeMap.clear(),this._spatialIndex.clear(),this._spatialValid=!1,this._state.clear(),this._cachedDirections.clear()}dispose(){this._graph&&this._graphChangeListener&&(this._graph.off("changed",this._graphChangeListener),this._graphChangeListener=null),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this.clear(),this._batches.clear(),this._batchPool.length=0,this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}_generateId(){return`edge_${Date.now()}_${Math.random().toString(36).slice(2,9)}`}_bindGraph(){const t=this._graph;this.beginBatch(),t.forEachLink(e=>{const i=this._dataFn?{fromId:e.fromId,toId:e.toId,...this._dataFn(e)}:{fromId:e.fromId,toId:e.toId};this.add({id:e.id,data:i})}),this.endBatch(),this._graphChangeListener=e=>{this.beginBatch();for(let i=0;i<e.length;i++){const s=e[i];if(s.link)if(s.changeType==="add"){if(!this._edgeMap.has(s.link.id)){const n=this._dataFn?{fromId:s.link.fromId,toId:s.link.toId,...this._dataFn(s.link)}:{fromId:s.link.fromId,toId:s.link.toId};this.add({id:s.link.id,data:n})}}else s.changeType==="remove"&&this.remove(s.link.id)}this.endBatch()},t.on("changed",this._graphChangeListener)}}const Tt="modulepreload",Nt=function(a){return"/ngraph.svg/"+a},st={},Dt=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){let r=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),h=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=r(e.map(l=>{if(l=Nt(l),l in st)return;st[l]=!0;const d=l.endsWith(".css"),_=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${_}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Tt,d||(m.as="script"),m.crossOrigin="",m.href=l,h&&m.setAttribute("nonce",h),document.head.appendChild(m),d)return new Promise((y,p)=>{m.addEventListener("load",y),m.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return s.then(r=>{for(const o of r||[])o.status==="rejected"&&n(o.reason);return t().catch(n)})};function It(a){const t=new Map,e=new Map;a.forEachNode(o=>{let h=0;a.forEachLinkedNode(o.id,()=>{h++}),t.set(o.id,h)});let i=[];t.forEach((o,h)=>{o<=1&&i.push(h)});let s=0,n=0;const r=t.size;for(;i.length>0;){const o=[];for(const h of i)e.has(h)||(e.set(h,s),n++,a.forEachLinkedNode(h,l=>{if(e.has(l.id))return;const d=t.get(l.id)-1;t.set(l.id,d),d<=1&&o.push(l.id)}));i=o,i.length>0&&s++}return n<r&&(s=n===0?0:s+1,t.forEach((o,h)=>{e.has(h)||e.set(h,s)})),{layerMap:e,maxLayer:s}}function Et(a,t,e=.3){const i=new Set;a.forEachLink(n=>{const r=t.getNodePosition(n.fromId),o=t.getNodePosition(n.toId);if(!r||!o)return;const h=r.x-o.x,l=r.y-o.y,d=Math.sqrt(h*h+l*l),_=t.getSpring(n.fromId,n.toId);if(!_)return;const m=_.length;if(m<=0)return;Math.abs(d-m)/m>e&&(i.add(n.fromId),i.add(n.toId))});const s=new Set(i);for(const n of i)a.forEachLinkedNode(n,r=>{s.add(r.id)});return s}const nt="CORE_LAYOUT",ot="LAYER_SETTLE",I="STRESS_DETECT",Q="STRESS_REFINE",k="DONE";class $t{constructor(t,e={}){this._graph=t,this._options=e,this._layout=null,this._running=!1,this._rafId=null,this._onUpdate=null,this._nodePositions=new Map,this._smoothing=e.smoothing??.15,this._maxSpeed=e.maxSpeed??50,this._lastFrameTime=0,this._energyThreshold=e.energyThreshold??.003,this._onStabilized=e.onStabilized||null,this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this._stableFramesRequired=e.stableFramesRequired??10,this._layeredLayout=e.layeredLayout??!0,this._stressThreshold=e.stressThreshold??.3,this._maxStressIterations=e.maxStressIterations??200,this._phase=null,this._layerMap=null,this._maxLayer=0,this._currentSettleLayer=0,this._stressPassCount=0,this._stressIterCount=0,this._graphChangeListener=null,this._hiddenNodes=new Set,this._initPromise=this._initLayout(e),this._graphGrowthListener=i=>{if(!this._layout)return;let s=!1;for(let n=0;n<i.length;n++)if(i[n].changeType==="add"&&(i[n].node||i[n].link)){s=!0;break}s&&this._stabilized&&!this._running?(this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this.start()):s&&!this._stabilized&&(this._stableFrameCount=0)},this._graph.on("changed",this._graphGrowthListener)}async _initLayout(t){const e=(await Dt(async()=>{const{default:_}=await import("./index-B4NOZCLv.js").then(m=>m.i);return{default:_}},__vite__mapDeps([0,1]))).default,i=this._graph,s=10,n=t.getNodeSize||(_=>{var y;const m=i.getNode(_);return((y=m==null?void 0:m.data)==null?void 0:y.size)||s});this._getNodeSize=n;const r=t.nodePadding??4,o=t.springLength||30,h=_=>{const m=i.getLinks(_),y=m?m.size??m.length??0:0,p=n(_);return 1+y/3+p*.1},l=(_,m)=>{const y=n(_.fromId),p=n(_.toId),c=(y+p)/2+r;m.length=Math.max(o,c)},d={springLength:o,springCoefficient:t.springCoefficient||8e-4,dragCoefficient:t.dragCoefficient||.04,gravity:t.gravity||-2,theta:t.theta||.8,timeStep:t.timeStep||20,...t,nodeMass:t.nodeMass||h,springTransform:t.springTransform||l};return this._layout=e(i,d),this._layout}async getLayout(){return await this._initPromise,this._layout}onUpdate(t){return this._onUpdate=t,this}async start(){if(await this._initPromise,this._running)return;this._running=!0,this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this._lastFrameTime=0,this._layeredLayout&&this._phase===null&&this._initOrchestration();const t=e=>{if(!this._running)return;const i=this._lastFrameTime?e-this._lastFrameTime:16.67;if(this._lastFrameTime=e,this._layout.step(),this._updateSmoothedPositions(i),this._layeredLayout&&this._phase!==null&&this._phase!==k){if(!this._stabilized)if(this._checkPhaseConvergence()){if(this._stableFrameCount++,this._stableFrameCount>=this._stableFramesRequired){const s=this._advancePhase();if(this._stableFrameCount=0,!s){this._stabilized=!0,this._updatePositions(),this._onUpdate&&this._onUpdate(this._nodePositions),this.stop(),this._onStabilized&&!this._stabilizedFired&&(this._stabilizedFired=!0,this._onStabilized());return}}}else this._stableFrameCount=0;this._phase===Q&&(this._stressIterCount++,this._stressIterCount>=this._maxStressIterations&&(this._unpinAll(),this._phase=I,this._stableFrameCount=0))}else if(!this._stabilized&&this._checkConvergence()){if(this._stableFrameCount++,this._stableFrameCount>=this._stableFramesRequired){this._stabilized=!0,this._updatePositions(),this._onUpdate&&this._onUpdate(this._nodePositions),this.stop(),this._onStabilized&&!this._stabilizedFired&&(this._stabilizedFired=!0,this._onStabilized());return}}else this._stabilized||(this._stableFrameCount=0);this._onUpdate&&this._onUpdate(this._nodePositions),this._rafId=requestAnimationFrame(t)};return this._rafId=requestAnimationFrame(t),this}stop(){return this._running=!1,this._rafId!==null&&(cancelAnimationFrame(this._rafId),this._rafId=null),this}async step(){return await this._initPromise,this._layout.step(),this._updatePositions(),this._nodePositions}async stabilize(t=100){await this._initPromise;for(let e=0;e<t&&(this._layout.step(),!this._checkConvergence());e++);return this._updatePositions(),this._nodePositions}async getNodePosition(t){return await this._initPromise,this._layout.getNodePosition(t)}async setNodePosition(t,e,i){await this._initPromise;const s=this._layout.getNodePosition(t);return s.x=e,s.y=i,this}async pinNode(t){await this._initPromise;const e=this._layout.getBody(t);return e&&(e.isPinned=!0),this}async unpinNode(t){await this._initPromise;const e=this._layout.getBody(t);return e&&(e.isPinned=!1),this}isRunning(){return this._running}getPositions(){return this._nodePositions}async getBounds(){await this._initPromise;let t=1/0,e=1/0,i=-1/0,s=-1/0;if(this._graph.forEachNode(o=>{if(this._hiddenNodes.has(o.id))return;const h=this._layout.getNodePosition(o.id);t=Math.min(t,h.x),e=Math.min(e,h.y),i=Math.max(i,h.x),s=Math.max(s,h.y)}),t>i)return{left:-100,top:-100,right:100,bottom:100,width:200,height:200};const n=i-t,r=s-e;if(n<1||r<1){const o=(t+i)/2,h=(e+s)/2;return{left:o-50,top:h-50,right:o+50,bottom:h+50,width:100,height:100}}return{left:t,top:e,right:i,bottom:s,width:n,height:r}}dispose(){this.stop(),this._graphChangeListener&&this._graph&&(this._graph.off("changed",this._graphChangeListener),this._graphChangeListener=null),this._graphGrowthListener&&this._graph&&(this._graph.off("changed",this._graphGrowthListener),this._graphGrowthListener=null),this._layout=null,this._graph=null,this._nodePositions.clear(),this._onUpdate=null}_checkConvergence(){if(!this._layout)return!1;let t=0;return this._graph.forEachNode(e=>{const i=this._layout.getBody(e.id);i&&i.velocity&&(t+=i.velocity.x*i.velocity.x+i.velocity.y*i.velocity.y)}),t<this._energyThreshold}isStabilized(){return this._stabilized}async getEnergy(){await this._initPromise;let t=0;return this._graph.forEachNode(e=>{const i=this._layout.getBody(e.id);i&&i.velocity&&(t+=i.velocity.x*i.velocity.x+i.velocity.y*i.velocity.y)}),t}_initOrchestration(){const{layerMap:t,maxLayer:e}=It(this._graph);this._layerMap=t,this._maxLayer=e,this._stressPassCount=0,this._stressIterCount=0,this._pinAll(),this._hiddenNodes.clear(),this._graph.forEachNode(i=>{if(t.get(i.id)===e){const s=this._layout.getBody(i.id);s&&(s.isPinned=!1)}else this._hiddenNodes.add(i.id),this._nodePositions.delete(i.id)}),e===0?(this._unpinAll(),this._hiddenNodes.clear(),this._phase=I):(this._phase=nt,this._currentSettleLayer=e-1),this._graphChangeListener||(this._graphChangeListener=()=>this._onGraphChanged(),this._graph.on("changed",this._graphChangeListener))}_checkPhaseConvergence(){if(!this._layout)return!1;let t=0;return this._graph.forEachNode(e=>{const i=this._layout.getBody(e.id);if(!(!i||i.isPinned)&&i.velocity){const s=i.velocity.x*i.velocity.x+i.velocity.y*i.velocity.y;s>t&&(t=s)}}),t<this._energyThreshold}_advancePhase(){switch(this._phase){case nt:return this._unpinLayer(this._currentSettleLayer),this._phase=ot,!0;case ot:return this._currentSettleLayer>0?(this._currentSettleLayer--,this._unpinLayer(this._currentSettleLayer),!0):(this._phase=I,this._advancePhase());case I:{if(this._stressPassCount>=3)return this._phase=k,!1;const t=Et(this._graph,this._layout,this._stressThreshold);if(t.size===0)return this._phase=k,!1;this._pinAll();for(const e of t){const i=this._layout.getBody(e);i&&(i.isPinned=!1)}return this._stressPassCount++,this._stressIterCount=0,this._phase=Q,!0}case Q:return this._unpinAll(),this._phase=I,!0;case k:return!1;default:return!1}}_unpinLayer(t){this._graph.forEachNode(e=>{if(this._layerMap.get(e.id)!==t)return;const i=this._layout.getBody(e.id);if(!i)return;let s=null;if(this._graph.forEachLinkedNode(e.id,n=>{if(this._layerMap.get(n.id)>t)return s=this._layout.getNodePosition(n.id),!0}),s||this._graph.forEachLinkedNode(e.id,n=>{if(!this._hiddenNodes.has(n.id))return s=this._layout.getNodePosition(n.id),!0}),s){const n=this._layout.getNodePosition(e.id),r=5;n.x=s.x+(Math.random()-.5)*r,n.y=s.y+(Math.random()-.5)*r}i.velocity&&(i.velocity.x=0,i.velocity.y=0),i.isPinned=!1,this._hiddenNodes.delete(e.id)})}_pinAll(){this._graph.forEachNode(t=>{const e=this._layout.getBody(t.id);e&&(e.isPinned=!0)})}_unpinAll(){this._graph.forEachNode(t=>{const e=this._layout.getBody(t.id);e&&(e.isPinned=!1)})}_onGraphChanged(){if(!(!this._layeredLayout||!this._layout)){for(const t of this._nodePositions.keys())this._graph.getNode(t)||(this._nodePositions.delete(t),this._hiddenNodes.delete(t));this._running&&(this._stabilized=!1,this._stabilizedFired=!1,this._stableFrameCount=0,this._initOrchestration())}}_updateSmoothedPositions(t){const e=this._smoothing>=1?1:1-Math.pow(1-this._smoothing,t/16.67),i=this._maxSpeed;this._graph.forEachNode(s=>{if(this._hiddenNodes.has(s.id))return;const n=this._layout.getNodePosition(s.id),r=this._nodePositions.get(s.id);if(!r){this._nodePositions.set(s.id,{x:n.x,y:n.y});return}let o=(n.x-r.x)*e,h=(n.y-r.y)*e;const l=Math.sqrt(o*o+h*h);if(l>i){const d=i/l;o*=d,h*=d}r.x+=o,r.y+=h})}_updatePositions(){this._graph.forEachNode(t=>{const e=this._layout.getNodePosition(t.id),i=this._nodePositions.get(t.id);i?(i.x=e.x,i.y=e.y):this._nodePositions.set(t.id,{x:e.x,y:e.y})})}}export{Ft as C,$t as F,Rt as N,J as R,At as c};
